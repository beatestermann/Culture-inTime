<div class="ui divider"></div>

<div class="meta">

<% if @production.layout_id %>
  <% prop = '' %>
  <% JSON.parse(@production.properties_with_labels_layout)["results"]["bindings"].each do |line| %>

      <% if prop !=  line.dig('label','value') %>
        <h2 title='<%= line.dig('p','value') %>'>
          <%= line.dig('label','value')  if  line.dig('label','value') %>    
        </h2>
        <% prop = line.dig('label','value') %>
      <% end %>
      <% if line.dig('o','type') != 'literal' %>
          <a href='?uri=<%= line.dig('o','value') %>'><%= line.dig('o_label','value') %></a>
      <% else %>
          <% next if  line.dig('o','xml:lang') != I18n.locale.to_s %>
          <%= line.dig('o','value')  %>
         
      <% end %>
      <br> 
  <% end %>

<% else %>
  <% prop = '' %>
  <% JSON.parse(@production.properties_with_labels)["results"]["bindings"].each do |line| %>
      <% if prop !=  line.dig('label','value') %>
        <h2 title='<%= line.dig('p','value') %>'>
          <%= line.dig('label','value')  if  line.dig('label','value') %>    
        </h2>
        <% prop = line.dig('label','value') %>
      <% end %>
      <% if line.dig('o','type') != 'literal' %>
          <a href='<%= line.dig('o','value') %>'><%= line.dig('o','value').split('/').last %></a>
            <% if line.dig('o_label','value') &&  line.dig('o','value').start_with?("http") %>
              <a href='?uri=<%= line.dig('o','value') %>'><i class="external square alternate icon"></i></a>
            <% end %>
          <%= line.dig('o_label','value') unless line.dig('o_label','value')  == line.dig('o','value').split('/').last %>
          <%= "@" + line.dig('o_label','xml:lang') if line.dig('o_label','xml:lang') %>
      <% else %>
          <%= line.dig('o','value')  %>
          <%= "@" + line.dig('o','xml:lang') if line.dig('o','xml:lang') %>
      <% end %>
      <br> 
  <% end %>

<% end %>

</div>

 

